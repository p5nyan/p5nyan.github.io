<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>レッスン 12</title>
    <link rel="stylesheet" href="lesson.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="./gist-embed.min.js"></script>
  </head>

  <body>
    <header>
      <h1>レッスン 12</h1>
      <p>〜 引数ありの関数定義 〜</p>
    </header>

    <nav class="back">
      <a href="../index.html">🔙</a>
      <a href="#">🔝</a>
    </nav>

    <main>
      <h2>サンプルコード</h2>

      <ul>
        <li>
          サポートサイトでは、先頭2行のおまじないとsetup関数の定義以外はすべて省略せずに<ruby
            >載<rt>の</rt></ruby
          >せています。
        </li>
        <li>
          本に載っていない部分には<span class="gray">灰色の背景色</span
          >を付けています。
        </li>
        <li>
          ここに載せているサンプルコードには、コードが読み取りやすいように「空行」を追加しています。
        </li>
        <li>
          キャプション横の
          <span class="p5link">p5.js</span>
          をクリックするとp5.jsのウェブエディターが開き、プログラムを実行することができます。
        </li>
      </ul>

      <nav class="codeNav">
        <select id="codeSelect">
          <option value="init" selected disabled>サンプルコードを選ぶ</option>
        </select>
        <label for="codeSelect">▼</label>
      </nav>

      <h3>12.1 引数ありの関数を定義する</h3>

      <h4 class="caption">
        <span>p.228</span>
        図12.4 ［構文］ 関数定義（引数あり、戻り値なし）
        <a
          href="https://editor.p5js.org/p5nyan/sketches/YUXPB4INm"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="35b59c28e33a884b913488b5d9f5a263"
        data-gist-highlight-line=""
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.229</span>
        コード12.3 myWalk関数の定義に引数を追加する、<wbr />図12.6
        引数ありの関数定義の比較コード
        <a
          href="https://editor.p5js.org/p5nyan/sketches/Y-erZ-YxG"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>コード12.3と図12.6のコードは同じ物です。</p>
      <code
        data-gist-id="67156e899d9d1457b5f8100860bc63d1"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.230</span>
        コード12.4 仮引数を追加して引数を増やす、<wbr />コード12.5
        上下交互に進ませる
        <a
          href="https://editor.p5js.org/p5nyan/sketches/dVl4QntFC"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="6f0c36a252d263d396b34c9b6f15dadb"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.230-231</span>
        本文のコード
        <a
          href="https://editor.p5js.org/p5nyan/sketches/z9xEQORxz"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        配列とオブジェクトをそれぞれ引数にしたものを同じコードに入れるため、関数名をそれぞれmyWalkArrayとmyWalkObjectにしています。
      </p>
      <code
        data-gist-id="d0b854b5e287c738f714947c46cdfd8f"
        data-gist-highlight-line="1-5, 7, 9-13, 22"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.231</span>
        コード12.6 配列を変数に入れてから引数にするときの注意点
        <a
          href="https://editor.p5js.org/p5nyan/sketches/0hnmzSyL0"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        引数が配列（やオブジェクト）でなければ、関数呼び出し先で値が書きかえられても、呼び出し元の変数の値は変わりません。引数が配列やオブジェクトのときのみ、関数の中で本体のデータも書きかえられてしまいます。
      </p>
      <code
        data-gist-id="8e81a34852824df76b614261dc2e3852"
        data-gist-highlight-line="1-3, 9-10"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.232</span>
        コード12.7 同じ名前の実引数と仮引数
        <a
          href="https://editor.p5js.org/p5nyan/sketches/Adi1YH5pE"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="5a3cd07d60a1ee967f4d7cda68c615e6"
        data-gist-highlight-line=""
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.232</span>
        コード12.8 異なる関数では同名の変数を宣言できる
        <a
          href="https://editor.p5js.org/p5nyan/sketches/3KvGjlQ1u"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="34c559a502882e4f60a327e3115de3b4"
        data-gist-hide-footer="true"
      ></code>

      <h3>12.2 変数のスコープ</h3>

      <h4 class="caption">
        <span>p.233</span>
        図12.12 ブロックと変数宣言
        <a href="" target="_blank" rel="noopener" class="p5link">p5.js</a>
      </h4>
      <p>
        変数宣言がエラーになるかどうかを確認するサンプルコードなので、実行しても何も起こりません。4行目をコメントアウトすると、7行目・12行目の変数xの宣言がエラーにならないことが確認できます。
      </p>
      <code
        data-gist-id="9d4043304b86488d3cf60c0ec7237700"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.234</span>
        図12.13 ブロックスコープの概念図
        <a
          href="https://editor.p5js.org/p5nyan/sketches/h56KsEeqd"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        14行目でエラーは出ますが、そのまま実行することができます。13行目までのprint関数はすべてコンソールに値を出力します。
      </p>
      <code
        data-gist-id="744c18da1a1d6df761875052a8895ffb"
        data-gist-highlight-line="1, 15"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.235</span>
        図12.15 if文とスコープ
        <a
          href="https://editor.p5js.org/p5nyan/sketches/yKKCcjTsO"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        9行目でエラーは出ますが、そのまま実行することができます。8行目までのprint関数はすべてコンソールに値を出力します。
      </p>
      <code
        data-gist-id="38261e37fbbb4e2335778b21193330c8"
        data-gist-highlight-line="1, 10"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.235</span>
        図12.16 for文とスコープ
        <a
          href="https://editor.p5js.org/p5nyan/sketches/YdHsrVkK2"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        10行目でエラーは出ますが、そのまま実行することができます。9行目までのprint関数はすべてコンソールに値を出力します。
      </p>
      <code
        data-gist-id="d6777677f1b3b9dca1afff09f3e497b5"
        data-gist-highlight-line="1, 11"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.236</span>
        図12.17 関数スコープ
        <a
          href=" https://editor.p5js.org/p5nyan/sketches/NuhyTnTQh"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="e56a472010aaee153ed8bdaf798f1420"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.236</span>
        コード12.9 関数の呼び出し元だけで宣言した変数
        <a href="" target="_blank" rel="noopener" class="p5link">p5.js</a>
      </h4>
      <p>エラーになるコードです。</p>
      <code
        data-gist-id="abf6ca5fbcedf696f63dd82a5101074a"
        data-gist-highlight-line=""
        data-gist-hide-footer="true"
      ></code>

      <h3>12.3 グローバル変数</h3>

      <h4 class="caption">
        <span>p.238</span>
        コード12.10 コードの先頭で宣言する
        <a
          href="https://editor.p5js.org/p5nyan/sketches/ARMJioD9E"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="b9e0a8841ef88fce136a8bbba4eefa19"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.238</span>
        コード12.11 グローバル変数があれば関数の引数は要らない......?
        <a
          href="https://editor.p5js.org/p5nyan/sketches/Be2vpoVTv"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        コードが読み取りやすいよう、グローバル変数の宣言場所を本から変更しています（すべての関数定義の外側なら、どこで宣言してもグローバル変数となります）。このサンプルコードのプログラムは意図どおり動きますが、関数の引数が使えるところは引数を使うのが良い作法です。
      </p>
      <code
        data-gist-id="0c09d3b51f221f432d253197eab48946"
        data-gist-highlight-line="1-4"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.239-240</span>
        コード12.12 図12.21のコードのdraw関数、<wbr />コード12.13
        キー入力で色を変える、<wbr />コード12.14
        ダブルクリックで歩行と停止を切り替える
        <a
          href="https://editor.p5js.org/p5nyan/sketches/Dd71DTt2d"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="50e3dcfc43cde7f5a8841c0786523b27"
        data-gist-highlight-line="5-8"
        data-gist-hide-footer="true"
      ></code>

      <h3>コラム：デフォルト引数</h3>

      <h4 class="caption">
        <span>p.242コラム</span>
        コードC12.a〜b デフォルト引数
        <a
          href="https://editor.p5js.org/p5nyan/sketches/mojbo7Oj9"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="5f1b20fa2074fddce15e2539a270b06f"
        data-gist-highlight-line="1-3, 8-9, 19"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.242-243コラム</span>
        コードC12.c〜d デフォルト引数の呼び出し
        <a
          href="https://editor.p5js.org/p5nyan/sketches/_m9fadgl8"
          target="_blank"
          rel="noopener"
          class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="0675ad506e5443916f1cf7941881923c"
        data-gist-highlight-line="1-3, 15"
        data-gist-hide-footer="true"
      ></code>

      <h2 id="ex">練習問題</h2>

      <h3>基本問題</h3>

      <p>
        レッスン11の基本問題を改良して、歩くたびに違う色の魚を落としていくプログラムを作りましょう。
      </p>
      <ol>
        <li>ピゴニャンが80歩ずつ歩く</li>
        <li>歩くたびに色の違う魚を落としていく</li>
        <li>色名は配列に入っており、配列の要素の数だけピゴニャンは歩く</li>
      </ol>

      <figure class="M">
        <img src="fig/ex12-1.png" width="500" />
      </figure>

      <a
        class="example"
        href="https://editor.p5js.org/p5nyan/full/jJH81aYcp"
        target="_blank"
        rel="noopener"
        >実行例</a
      >

      <p>
        新しい「ピゴニャンのスケッチ」を用意して次のコードと置きかえ、配列colorsの要素（色名）をdropFish関数に引数で渡すようにします。dropFish関数の仮引数の名前はcolとします。実引数の名前は自由に決めてかまいません。
      </p>

      <code
        data-gist-id="3244cb86ad9511f4d80dba909419d940"
        data-gist-hide-footer="true"
      ></code>

      <p>ヒントは次のとおり</p>
      <ul>
        <li>
          問1は配列の繰り返しの復習ですね。for...of文を使うとよいでしょう。
        </li>
        <li>問3は2ヵ所書きかえる必要があります。</li>
      </ul>

      <details>
        <summary>解答例</summary>
        <code
          data-gist-id="ee59fd7e7e7543148fee0d111bfe8b50"
          data-gist-hide-footer="true"
        ></code>
      </details>
    </main>

    <h3>発展問題</h3>

    <p>
      レッスン11の発展問題を改良して、ピゴニャンが5回魚にぶつかる前に食べきれるかを競うゲームにしてみましょう。魚の速度も上がっていきます。レッスン11から変わるところだけ説明します。
    </p>

    <ol>
      <li>
        魚の配置方法はレッスン11と同じだが、すべて同じ青色（既定値）とする。また、魚が動くたびに速度が上がっていくように変更する。
      </li>
      <li>
        魚の行進（全体移動）処理は<ruby>marchFish<rt>マーチフィッシュ</rt></ruby
        >関数とする。引数に、魚の移動距離（速度）を受け取る。
      </li>
      <li>
        ピゴニャンが魚にぶつかると、ピゴニャンの色が変わる（そのかわりピゴニャンが魚を食べたときに色は変えない）。5回当たると黒くなって終了、「Game
        Over...」としゃべる。
      </li>
      <li>ゲームが終わると魚が止まり、キー入力も受け付けなくなる。</li>
    </ol>

    <figure class="M">
      <img src="fig/ex12-2.png" width="500" />
    </figure>

    <a
      class="example"
      href="https://editor.p5js.org/p5nyan/full/8l_QSUgG8"
      target="_blank"
      rel="noopener"
      >実行例</a
    >

    <p>
      新しい「ピゴニャンのスケッチ」を用意して次のコードと置きかえ、<mark
        >/* */</mark
      >
      でコメントアウトされた部分の指示どおりにコードを編集してください。
    </p>

    <code
      data-gist-id="80b316d6951b24568c3f2c4b94ce0f82"
      data-gist-hide-footer="true"
    ></code>

    <p>ヒントは次のとおり</p>
    <ul>
      <li>
        複数の関数から使用する変数がグローバルスコープでスケッチの先頭に定義されています。ピゴニャンの色の配列（cols）、スコア（score）、そして、ゲームの終了をコントロールするフラグ（playing）です。これらはスケッチの中のどこからでもアクセス（読み取り・変更）できます。
      </li>
      <li>
        問1は、無限ループからフラグを使った終了条件への変更です。グローバル変数playingを使う…とコメントにありますが、この変数がどこでどのように変更されているか、コード全体を読んでみましょう。
      </li>
      <li>
        問2は引数ありの関数呼び出しです。関数定義のところのコメントを読んで、何を引数にするのか考えてください。
      </li>
      <li>
        問3は引数ありの関数定義です。仮引数の名前はコメントで指定されたとおりにしてください。
      </li>
      <li>
        問4・問5はレッスン9（配列）の復習です。配列colsの要素を先頭からひとつずつ取り出す（削除する）ことで、最後にピゴニャンが黒くなったときには配列が空になることを利用しています。
      </li>
      <li>
        問6は、ゲームが終了したときにキー入力を受け付けなくするための処理です。他にもこれとよく似た処理があります。
      </li>
    </ul>

    <details>
      <summary>解答例</summary>
      <code
        data-gist-id="b5f8f18789a3fd8e0f1467d76ef0a6a6"
        data-gist-hide-footer="true"
      ></code>
    </details>

    <footer>
      『 はじめての “文字で打ちこむ” プログラミングの本 』 サポートサイト
    </footer>

    <script src="codeNav.js" type="module"></script>
  </body>
</html>
