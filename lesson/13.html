<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>レッスン 13</title>
    <link rel="stylesheet" href="lesson.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&display=swap" rel="stylesheet" />
    <script src="./gist-embed.min.js"></script>
  </head>

  <body>
    <header>
      <h1>レッスン 13</h1>
      <p>〜 戻り値ありの関数定義 〜</p>
    </header>

    <nav class="back">
      <a href="../index.html">🔙</a>
      <a href="#">🔝</a>
    </nav>

    <main>
      <h2>サンプルコード</h2>

      <ul>
        <li>
          サポートサイトでは、先頭2行のおまじないとsetup関数の定義以外はすべて省略せずに<ruby>載<rt>の</rt></ruby
          >せています。
        </li>
        <li>本に載っていない部分には<span class="gray">灰色の背景色</span>を付けています。</li>
        <li>
          2つ目のサンプルコードからは先頭2行のおまじないと
          <mark>function setup() { ... }</mark>
          は省略しますが、みなさんのコードからは消さないでください。
        </li>
        <li>ここに載せているサンプルコードには、コードが読み取りやすいように「空行」を追加しています。</li>
        <li>
          キャプション横の
          <span class="p5link">p5.js</span>
          をクリックするとp5.jsのウェブエディターが開き、プログラムを実行することができます。
        </li>
      </ul>

      <div class="sketchLink" style="width: 50%">
        <a href="https://editor.p5js.org/p5nyan/sketches/fHkjcRuKX" target="_blank" rel="noopener">
          ピゴニャンのスケッチを開く
        </a>
      </div>

      <nav class="codeNav">
        <select id="codeSelect">
          <option value="init" selected disabled>サンプルコードを選ぶ</option>
        </select>
        <label for="codeSelect">▼</label>
      </nav>

      <h3>13.1 戻り値ありの関数を定義する</h3>

      <h4 class="caption">
        <span>p.247</span>
        図13.3 ［構文］ 関数定義(引数あり、戻り値あり)
        <a href="https://editor.p5js.org/p5nyan/sketches/2pPFzHVBQ" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="9696415879064694c2333c9d7bf39af4"
        data-gist-highlight-line="1-8"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.248</span>
        コード13.1 return文は関数の最後に書く
        <a href="https://editor.p5js.org/p5nyan/sketches/vxRUKzgai" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="1edc4937eabbb90dd5002de92cf2082a"
        data-gist-highlight-line="1-4"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.248</span>
        本文のコード
        <a href="https://editor.p5js.org/p5nyan/sketches/79MIEaC55" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="d5f98be8c708f74aa5e001cbbe5cc20e"
        data-gist-highlight-line="1-4, 12"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.249-250</span>
        コード13.2 ピゴニャンを斜めに歩かせる
        <a href="https://editor.p5js.org/p5nyan/sketches/AORTJqx25" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code data-gist-id="9952b85c504e9ca6cd26edeb425417b9" data-gist-hide-footer="true"></code>

      <h4 class="caption">
        <span>p.251</span>
        コード13.3 isOutside関数の定義、<wbr />コード13.4 isOutside関数の呼び出し
        <a href="https://editor.p5js.org/p5nyan/sketches/edvDTjdOE" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <p>コード13.2のmyWalk関数がないとエラーになるので注意。</p>
      <code
        data-gist-id="5c34ee4f11bb579690d3959fc028d3f8"
        data-gist-highlight-line="1-5, 24-33"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.252</span>
        コード13.5 ダブルクリックされたことをdraw関数に伝える、<wbr />コード13.6 draw関数の中のif文を書きかえる
        <a href="https://editor.p5js.org/p5nyan/sketches/J8XOxeXJq" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        doubleClicked関数は読みやすいように一番上に置きました（どこでも構いません）。<br />
        コードが長くなってきたので、ここまでに登場した関数からは説明コメントを省き、isOutside関数は三項演算子などを使って短くしています（くべてみてください）。
      </p>
      <code
        data-gist-id="9a3788b232bc15be3f105c30ea71aa18"
        data-gist-highlight-line="8-21, 27-48"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.252-253</span>
        コード13.7 ピゴニャンをクリックしたか判定する、<wbr />コード13.8 isP5nyan関数の定義
        <a href="https://editor.p5js.org/p5nyan/sketches/0ox0iFSdU" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="149558acee11ab0705a7622dd655b254"
        data-gist-highlight-line="1-3, 11-49"
        data-gist-hide-footer="true"
      ></code>

      <h3>13.2 関数式</h3>

      <h4 class="caption">
        <span>p.255</span>
        コード13.9 無名関数は呼び出せない
        <a href="https://editor.p5js.org/p5nyan/sketches/frHR_6lW-" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="8527231d5018f4c54f4d5e4ffcfb4054"
        data-gist-highlight-line="1-3, 5-6, 14"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p255-256-コード13.10-本文コード</span>
        コード13.10 アロー関数を定義して使ってみる
        <a href="https://editor.p5js.org/p5nyan/sketches/gjy4HZYpf" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <p>
        26行目のコードを有効にする場合は、17〜23行目のコードをコメントアウトしてください。biggerNum関数の呼び出しで引数に固定値を渡しているところ、試しに乱数に変更してみてください。
      </p>
      <code
        data-gist-id="8eeb8244c526e520a9409314440e2add"
        data-gist-highlight-line=""
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.256</span>
        図13.12 ［構文］ アロー関数（の例）
        <a href="" target="_blank" rel="noopener" class="p5link">p5.js</a>
      </h4>
      <p>結果がわかりやすいよう、sleep関数を追加しています。</p>
      <code
        data-gist-id="6ca0b5e29f6d1bc0756bb2b80ea8c321"
        data-gist-highlight-line="1-3, 10-11, 15-16, 20"
        data-gist-hide-footer="true"
      ></code>

      <h3>13.3 アロー関数を使った配列のメソッド</h3>

      <h4 class="caption">
        <span>p258</span>
        図13.13 ［構文］ アロー関数を使う配列メソッド
        <a href="https://editor.p5js.org/p5nyan/sketches/RxMUaqXaL" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <p>結果がわかりやすいよう、sleep関数を追加しています。</p>
      <code
        data-gist-id="6e73d555a3482d70063d30be62bb5070"
        data-gist-highlight-line="1-3, 6-7, 10-11, 14"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.259</span>
        コード13.11 forEachメソッド
        <a href="https://editor.p5js.org/p5nyan/sketches/Yv7edMToj" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="144d86088a9af5e6640c28a15ee60b40"
        data-gist-highlight-line="1-3, 11, 14"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.259</span>
        コード13.12 mapメソッド
        <a href="https://editor.p5js.org/p5nyan/sketches/uxjBl21g-" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="010bf2489d65a1a5dca01c2244fa57f9"
        data-gist-highlight-line="1-3, 13, 17"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.260</span>
        コード13.13 filterメソッド
        <a href="https://editor.p5js.org/p5nyan/sketches/fzVSJFhc1" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="f0690fc37689fffb6bd52ca1173c8ac2"
        data-gist-highlight-line="1-3, 13, 17"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.260</span>
        コード13.14 everyメソッド
        <a href="" target="_blank" rel="noopener" class="p5link">p5.js</a>
      </h4>
      <code
        data-gist-id="caa4a88a5a0047d4ced226c5a06e4c45"
        data-gist-highlight-line="1-3, 17, 22"
        data-gist-hide-footer="true"
      ></code>

      <h3>コラム：クラス</h3>

      <h4 class="caption">
        <span>p.262コラム</span>
        本文のコード
        <a href="https://editor.p5js.org/p5nyan/sketches/_jA0DRIXy" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code
        data-gist-id="beefbe6003739b700b4fa2dbcbe555f5"
        data-gist-highlight-line="1-3, 6, 8, 11"
        data-gist-hide-footer="true"
      ></code>

      <h4 class="caption">
        <span>p.263コラム</span>
        本文のコード
        <a href="https://editor.p5js.org/p5nyan/sketches/QPGF_ZVAA" target="_blank" rel="noopener" class="p5link"
          >p5.js</a
        >
      </h4>
      <code data-gist-id="f8ed73deafe977a64becc62feb96fa90" data-gist-hide-footer="true"></code>

      <h2 id="ex">練習問題</h2>

      <h3>基本問題</h3>

      <p>次のようなプログラムを引数あり／戻り値ありの関数定義を使って作りたいとします。</p>

      <ul>
        <li>ピゴニャンが80歩ずつ歩く</li>
        <li>歩くたびに色の違う魚を落としていく</li>
        <li>歩くたびにサイコロを振り（1〜6の乱数を生成する）、3の倍数が出たら「アウト」としゃべって止まる</li>
        <li>「アウト」でなかったときは「セーフ」としゃべる</li>
      </ul>

      <figure class="M">
        <img src="fig/ex13-1.png" width="600" />
      </figure>

      <a class="example" href="https://editor.p5js.org/p5nyan/full/06uXJ_Az9" target="_blank" rel="noopener">実行例</a>

      <p>
        新しい「ピゴニャンのスケッチ」を用意して次のコードと置きかえ、dropFish関数の中でサイコロを振り、出た目が3の倍数だったときは戻り値として「アウト」、それ以外のときは「セーフ」と返すようにします。
      </p>

      <code data-gist-id="d5d8084477cea32c216023c9bebc9b1d" data-gist-hide-footer="true"></code>

      <p>
        ヒント：問1〜5を順番に埋めていく必要はありません。まずは問3〜5から埋めるとよいでしょう。問2は1行コードではなく、if文になります。
      </p>

      <details>
        <summary>解答例</summary>
        <code data-gist-id="75b64c279da9f7ef07e4a5ef5a1b8be9" data-gist-hide-footer="true"></code>
      </details>

      <h3>発展問題</h3>
      <p>
        レッスン12の発展問題を改良して、ゲームオーバーにならず魚を食べきったときは魚の数をしゃべるようにしましょう。魚を食べたときにランダムにスコア（得点）を与え、ハイスコアの魚を何匹食べたか、最後に魚を並べて表示します。<br />
        以下、レッスン12から変わるところだけ説明します。
      </p>

      <ol>
        <li>
          レッスン12と同じように、上下にピゴニャンを動かしたときに魚を食べる。魚を食べたとき、1〜10のランダムなスコアを<ruby
            >獲得<rt>かくとく</rt></ruby
          >する。獲得したスコアをしゃべる。
        </li>
        <li>
          魚に5回ぶつかったときに加えて、魚をすべて食べたときにもゲームを終了する。魚の残り数は getFishNum関数
          で調べられる。
        </li>
        <li>
          ゲームオーバーで終わらなかった場合は、ピゴニャンをキャンバス中央付近に移動させ、食べた魚をしゃべらせる。
        </li>
        <li>
          食べた魚のスコアを配列に記録しておき、ハイスコア（6以上）の魚の数をしゃべらせる。また、その数だけ魚をキャンバス中央に並べる。
        </li>
        <li>ゲームがゲームオーバーで終わったかどうかは、marchFish関数の戻り値でdraw関数に伝える。</li>
      </ol>

      <figure class="L">
        <img src="fig/ex13-2.png" width="900" />
      </figure>

      <a class="example" href="https://editor.p5js.org/p5nyan/full/M9Kc6qXmY" target="_blank" rel="noopener">実行例</a>

      <p>
        新しい「ピゴニャンのスケッチ」を用意して次のコードと置きかえ、<mark>/* */</mark>
        でコメントアウトされた部分の指示どおりにコードを編集してください。
      </p>

      <code data-gist-id="c198053ca453be875dfad965132ddf23" data-gist-hide-footer="true"></code>

      <p>ヒントは次のとおり</p>
      <ul>
        <li>
          まず、魚を食べたときにスコアを取得するところ（問9〜問10）に取り組むとよいでしょう。問10がうまく書けたかどうかはprint文で配列を表示すればわかります。
        </li>
        <li>
          問1は、自分で定義した戻り値ありの関数の呼び出しです。戻り値を受け取る変数はどうするか、まわりのコードをよく読んでください。
        </li>
        <li>問2は、問1の結果を使います。</li>
        <li>問3と問6はテンプレート文字列や配列の復習です。</li>
        <li>
          問4は関数式（アロー関数）を使った配列のメソッドを使います。条件を満たしたものだけ残して新しい配列を作るメソッドは…
        </li>
        <li>問5は、実行例を見ながら自由に書いてみてください。動きがちょっと違ってもかまいません。</li>
        <li>問7は、関数定義の中のどこにreturn文を入れるか、考えてみましょう。2箇所あります。</li>
        <li>
          問8はおまけです。return文は、戻り値を付けずに呼び出して、break文のように使うこともあります（指定しなければundefinedという値が返ります）。if文の
          { } も省略できるので、条件を満たせば関数定義から抜け出すコードが1行で書けます。
        </li>
      </ul>

      <details>
        <summary>解答例</summary>
        <code data-gist-id="a157ae90331017edf4f7fb2db7decaad" data-gist-hide-footer="true"></code>
      </details>
    </main>

    <footer>『 はじめての “文字で打ちこむ” プログラミングの本 』 サポートサイト</footer>

    <script src="codeNav.js" type="module"></script>
  </body>
</html>
